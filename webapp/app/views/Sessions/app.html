#{extends 'studio.html' /}
#{set title:'Online Guitar Tuner' /}


#{set 'contentHeader'}
 <h1>${seshion?.name}</h1>
#{/set}

Raw data

${seshion.data}

	
	</script>
	<br/>
	<a href="/sessions/addTrack?sessionId=${seshion.id}&track={'id':44,'name':'Untitled','regions':[]}">add track to session</a>
	<br/>
	<a href="/sessions/addRegion?sessionId=${seshion.id}&trackId=44&region={'id':45,'start_position':'100000'}">add region to track</a>
	<div id ="mouseContainer" style="position:relative; min-height:200px">
		<div id="aacom" style="position:absolute; left:50px">
			user1
		</div>
		<div id="sscom" style="position:absolute; left:50px">
			user2
		</div>
	</div>
	<script src="@{'/public/javascripts/socket.io.js'}" type="text/javascript" charset="${_response_encoding}"></script>
	<script>
	$(document).ready(function() {
	  	var studio = io.connect('http://localhost:9001/studio');
	  	studio.on('ready', function (data) {
		    console.log(data);
	  	});
	  	studio.on('mouseBroadcast', function (data) {
	    	console.log(data);
	    	setMousePointer(data)
	  	});
	  	
	    	  	
	  	var waiting = false;
	    var sendMouseEvent = function(event) {
	    	if(!waiting) {
	    		waiting = true;
	    		_.delay(function(){waiting = false}, 100);
			    var parentOffset = $("#mouseContainer").offset(), 
	    		relX = event.pageX - parentOffset.left,
	    		relY = event.pageY - parentOffset.top;
	    		
	    		var username = "${user.id.id}";
	    		username = username.replace("@","")
				.replace(".","");
		    	studio.emit('mouseMoved', { us4ername: username, x: relX, y: relY});
	    		
	    		setMousePointer({username: username, x:relX, y:relY});
	    	}
	    }
	    
	    var setMousePointer = function(event){
	    		
	    	console.log ("Moving pointer", event)		
    		$("#" + event.username ).css({
	    		"left": event.x,
	    		"top": event.y
	    		},
	    		30);;
    	}
	    
	  	//$("#content-body").mousemove(sendMouseEvent);
	});
	</script>